{{ define "editor" }}
<!DOCTYPE html>
<html>
<head runat="server">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <link rel="icon" href="/filestore/icons/{{.favicon}}.svg" type="image/svg+xml" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
    <!--
    *
    * (c) Copyright Ascensio System SIA 2025
    *
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    *     http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    *
    -->
    <title>ONLYOFFICE</title>
    <style>
        body {
            height: 100%;

            margin: 0;
            
            padding: 0;
            overflow-y: hidden;
            
            font-family: "Open Sans", sans-serif;
            font-size: 12px;
            font-weight: normal;
            text-decoration: none;

            color: #333;
            background: #fff;
        }

        .form {
            height: 100%;
        }

        div {
            margin: 0;
            padding: 0;
        }

        .loading-container {
            display: flex;
            height: 100vh;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            background-color: #fff;
        }

        .loading-container.hide {
            display: none;
        }

        .spinner {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            position: relative;
            width: 48px;
            height: 48px;
            margin: 16px;
        }

        .spinner__circle {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #D8DEE9;
            border-radius: 100%;
            animation: spin 800ms infinite linear;
        }

        .spinner__circle_inner,
        .spinner__circle_gradient {
            position: absolute;
            width: calc(100% - 10px);
            height: calc(100% - 10px);
            transform: translate(-50%, -50%);
        }

        .spinner__circle_inner {
            top: 50%;
            left: 50%;
            background-color: white;
            border-radius: 100%;
        }

        .spinner__circle_gradient {
            top: -45%;
            left: 11%;
            background-color: #D8DEE9;
            background-image: linear-gradient(0deg, #D8DEE9 0%, #5E6A8A 50%);
            transform: rotate(-45deg);
        }

        @keyframes spin {
            100% {
                transform: rotate(360deg);
            }
        }

        .error-page {
            display: none;
            height: 100vh;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
            margin: 0;
            font-family: "Open Sans", sans-serif;
            background-color: #fff;
        }

        .error-page.show {
            display: flex;
        }

        .error-message {
            margin-top: 12px;
            font-weight: 600;
            font-size: 23px;
            line-height: 28px;
            letter-spacing: 0px;
            text-align: center;
            color: #333;
            margin-bottom: 16px;
            max-width: 500px;
        }

        .error-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 0px;
        }

        .error-button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
            font-family: "Open Sans", sans-serif;
        }

        .error-button.secondary {
            background: #6c757d;
            color: white;
        }

        .error-button.secondary:hover {
            background: #545b62;
        }
    </style>
</head>

<body>
    <div id="loadingContainer" class="loading-container">
        <div class="spinner">
            <div class="spinner__circle">
                <div class="spinner__circle_gradient"></div>
                <div class="spinner__circle_inner"></div>
            </div>
        </div>
    </div>
    <div class="form">
        <div id="iframeEditor">
        </div>
    </div>
    <div id="errorPage" class="error-page">
        <svg width="360" height="360" viewBox="0 0 360 360" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g filter="url(#filter0_d_231_2170)">
                <path
                    d="M127.076 110.445C127.076 108.793 128.411 107.453 130.059 107.453H227.742L247.876 127.647V266.008C247.876 267.661 246.541 269 244.893 269H130.059C128.411 269 127.076 267.661 127.076 266.008V110.445Z"
                    fill="white" />
            </g>
            <g filter="url(#filter1_d_231_2170)">
                <path
                    d="M127.076 266.008V110.445C127.076 108.896 128.25 107.622 129.755 107.469L130.059 107.453H227.742L247.876 127.647V266.008L247.859 266.314C247.718 267.723 246.602 268.841 245.197 268.984L244.893 269V128.885L226.508 110.445H130.059V269L129.755 268.984C128.35 268.841 127.234 267.723 127.093 266.314L127.076 266.008ZM244.893 266.008V269H130.059V266.008H244.893Z"
                    fill="#AAAAAA" />
            </g>
            <path d="M225.505 107.455L246.384 128.396H226.997C226.173 128.396 225.505 127.726 225.505 126.9V107.455Z"
                fill="#AAAAAA" />
            <path
                d="M245.318 171.81C244.884 172.45 245.011 173.309 245.59 173.797L245.71 173.888L246.201 174.239C247.37 175.11 248.704 176.339 250.21 177.741C251.891 179.307 253.753 181.054 255.655 182.519C257.543 183.974 259.601 185.256 261.71 185.788C263.763 186.307 265.872 186.11 267.806 184.746L268.191 184.457C269.433 183.468 270.574 181.872 271.57 180.163C272.585 178.42 273.53 176.417 274.341 174.489C275.156 172.556 275.846 170.672 276.355 169.152C276.786 167.863 277.112 166.751 277.249 166.096L277.296 165.845L277.312 165.692C277.352 164.935 276.817 164.256 276.053 164.135C275.291 164.015 274.573 164.499 274.382 165.232L274.35 165.381L274.271 165.74C274.15 166.225 273.901 167.076 273.526 168.202C273.039 169.658 272.374 171.471 271.594 173.325C270.811 175.185 269.922 177.06 268.995 178.653C268.048 180.281 267.132 181.482 266.336 182.115L266.109 182.285C264.973 183.093 263.78 183.226 262.439 182.888C260.925 182.505 259.256 181.519 257.473 180.145C255.704 178.782 253.95 177.141 252.24 175.548C250.777 174.187 249.312 172.83 247.961 171.825L247.391 171.415L247.26 171.336C246.595 170.975 245.754 171.17 245.318 171.81Z"
                fill="#AAAAAA" />
            <path
                d="M283.11 167.729C282.028 168.1 280.863 168.077 279.873 167.955C278.866 167.831 277.886 167.582 277.143 167.392C276.754 167.294 276.45 167.214 276.199 167.161C275.991 167.116 275.904 167.11 275.895 167.107H275.916H275.764C275.008 167.078 274.381 166.48 274.334 165.707C274.284 164.935 274.83 164.26 275.576 164.138L275.728 164.12H276.022C276.316 164.133 276.602 164.19 276.818 164.236C277.143 164.305 277.519 164.401 277.882 164.494C278.639 164.688 279.446 164.89 280.236 164.987C281.042 165.086 281.683 165.057 282.145 164.899C282.485 164.782 282.752 164.592 282.949 164.209L283.03 164.033C283.335 163.265 284.203 162.893 284.967 163.2C285.732 163.506 286.105 164.377 285.799 165.144L285.692 165.394C285.13 166.612 284.193 167.358 283.11 167.729Z"
                fill="#AAAAAA" />
            <path
                d="M129.337 178.699C129.928 179.199 130.035 180.06 129.608 180.685L129.516 180.807L129.137 181.276C128.245 182.431 127.288 183.975 126.213 185.729C125.012 187.69 123.686 189.874 122.246 191.798C120.817 193.706 119.176 195.495 117.288 196.577C115.448 197.63 113.365 198.007 111.136 197.214L110.688 197.039C109.226 196.421 107.701 195.19 106.284 193.811C104.84 192.405 103.394 190.731 102.096 189.092C100.795 187.45 99.6251 185.821 98.7294 184.492C97.9695 183.366 97.3573 182.383 97.0499 181.789L96.937 181.561L96.8808 181.417C96.639 180.699 96.9741 179.9 97.6767 179.579C98.3797 179.259 99.2006 179.529 99.5815 180.186L99.6511 180.321L99.8237 180.645C100.07 181.079 100.536 181.833 101.2 182.816C102.058 184.087 103.183 185.655 104.432 187.231C105.683 188.811 107.041 190.38 108.361 191.665C109.709 192.977 110.912 193.887 111.848 194.284L112.112 194.387C113.423 194.86 114.608 194.667 115.809 193.979C117.165 193.202 118.51 191.804 119.86 190C121.199 188.211 122.448 186.157 123.671 184.163C124.715 182.458 125.764 180.757 126.796 179.425L127.236 178.877L127.342 178.765C127.884 178.238 128.748 178.199 129.337 178.699Z"
                fill="#AAAAAA" />
            <path
                d="M91.8406 184.942C92.9827 185.007 94.0984 184.672 95.0203 184.288C95.9557 183.898 96.8335 183.395 97.4987 183.012C97.8461 182.812 98.1188 182.653 98.3459 182.533C98.5346 182.435 98.6158 182.405 98.6237 182.4L98.6045 182.405L98.7508 182.366C99.471 182.134 99.9145 181.389 99.7546 180.631C99.5948 179.874 98.8886 179.373 98.1371 179.454L97.9862 179.478L97.7024 179.557C97.4231 179.65 97.1624 179.781 96.9664 179.883C96.6726 180.037 96.3366 180.231 96.0124 180.418C95.3335 180.809 94.6104 181.22 93.8747 181.527C93.1263 181.839 92.4998 181.984 92.013 181.956C91.6542 181.935 91.3451 181.823 91.0536 181.507L90.9294 181.359C90.4295 180.703 89.4937 180.577 88.8391 181.078C88.1847 181.579 88.0592 182.518 88.5591 183.175L88.7292 183.386C89.596 184.408 90.6975 184.874 91.8406 184.942Z"
                fill="#AAAAAA" />
            <path
                d="M177.782 151.58C177.782 153.646 176.113 155.319 174.054 155.319C171.994 155.319 170.325 153.646 170.325 151.58C170.325 149.514 171.994 147.84 174.054 147.84C176.113 147.84 177.782 149.514 177.782 151.58Z"
                fill="#AAAAAA" />
            <path
                d="M206.118 151.58C206.118 153.646 204.449 155.319 202.39 155.319C200.33 155.319 198.661 153.646 198.661 151.58C198.661 149.514 200.33 147.84 202.39 147.84C204.449 147.84 206.118 149.514 206.118 151.58Z"
                fill="#AAAAAA" />
            <path fill-rule="evenodd" clip-rule="evenodd"
                d="M274.438 107.369C277.279 104.495 281.51 103.887 284.922 105.554L299.473 91.3904C299.987 90.8716 300.814 90.8695 301.326 91.3862L302.249 92.3193C302.757 92.8337 303.84 94.0646 303.327 94.5832L302.043 95.8649L305.008 98.8643C305.519 99.3808 305.518 100.218 305.005 100.737L303.35 102.41C302.836 102.929 302.013 102.924 301.502 102.41L298.361 99.5423L288.776 109.119C290.882 112.673 290.409 117.362 287.365 120.44C283.777 124.069 277.974 124.084 274.405 120.474C270.835 116.865 270.85 110.996 274.438 107.369ZM280.718 109.52C283.039 109.52 284.922 111.425 284.922 113.772C284.922 116.121 283.039 118.023 280.718 118.023C278.395 118.023 276.513 116.121 276.513 113.772C276.513 111.425 278.395 109.52 280.718 109.52Z"
                fill="#AAAAAA" />
            <path
                d="M83.827 132.882H80.8442V124.663C80.8442 119.582 76.6339 114.933 71.8961 114.933C66.6764 114.933 62.948 119.582 62.948 124.663V132.882H59.9653V124.663C59.9653 117.649 65.3169 111.941 71.8961 111.941C78.4754 111.941 83.827 117.649 83.827 124.663V132.882Z"
                fill="#AAAAAA" />
            <path
                d="M85.2484 156.816H58.5443C56.8572 156.816 55.4915 155.567 55.4915 154.023V132.684C55.4915 131.141 56.8572 129.892 58.5443 129.892H85.2484C86.9354 129.892 88.3012 131.141 88.3012 132.684V154.023C88.3012 155.567 86.9354 156.816 85.2484 156.816Z"
                fill="#E2E2E2" />
            <path
                d="M86.8097 132.683C86.8096 132.092 86.2436 131.386 85.2484 131.386H58.544C57.5488 131.386 56.9829 132.092 56.9827 132.683V154.022C56.9829 154.613 57.5488 155.319 58.544 155.319H85.2484C86.1811 155.319 86.7362 154.698 86.8024 154.135L86.8097 154.022V132.683ZM89.7924 154.022L89.7866 154.254C89.657 156.628 87.5527 158.311 85.2484 158.311H58.544C56.1653 158.311 54.0001 156.517 54 154.022V132.683C54.0001 130.188 56.1653 128.395 58.544 128.395H85.2484C87.6271 128.395 89.7923 130.188 89.7924 132.683V154.022Z"
                fill="#AAAAAA" />
            <path
                d="M76.3702 141.858C76.3702 144.337 74.3672 146.346 71.8962 146.346C69.4252 146.346 67.4221 144.337 67.4221 141.858C67.4221 139.38 69.4252 137.371 71.8962 137.371C74.3672 137.371 76.3702 139.38 76.3702 141.858Z"
                fill="white" />
            <path
                d="M190.852 168.569C191.591 168.728 192.104 169.426 192.019 170.195C191.928 171.016 191.189 171.609 190.371 171.517L189.104 171.392C186.262 171.145 184.238 171.232 182.996 171.646C182.326 171.87 182.046 172.137 181.922 172.343C181.818 172.518 181.718 172.826 181.794 173.396L181.837 173.658L181.861 173.809C181.933 174.563 181.425 175.266 180.668 175.419C179.91 175.57 179.172 175.118 178.95 174.394L178.913 174.244L178.837 173.788C178.698 172.729 178.829 171.703 179.366 170.805C179.974 169.787 180.965 169.172 182.053 168.809C184.152 168.107 187.181 168.152 190.702 168.544L190.852 168.569Z"
                fill="#AAAAAA" />
            <path
                d="M112.163 234.597C112.163 226.336 118.84 219.639 127.076 219.639H249.367C257.604 219.639 264.281 226.336 264.281 234.597C264.281 242.859 257.604 249.555 249.367 249.555H127.076C118.84 249.555 112.163 242.859 112.163 234.597Z"
                fill="#F5F5F5" />
            <path
                d="M262.789 234.596C262.789 227.161 256.781 221.134 249.367 221.134H127.076C119.663 221.134 113.654 227.161 113.654 234.596C113.654 242.032 119.663 248.059 127.076 248.059H249.367C256.781 248.059 262.789 242.032 262.789 234.596ZM265.772 234.596C265.772 243.683 258.427 251.05 249.367 251.05H127.076C118.016 251.05 110.671 243.683 110.671 234.596C110.671 225.509 118.016 218.143 127.076 218.143H249.367C258.427 218.143 265.772 225.509 265.772 234.596Z"
                fill="#FF6F3D" />
            <path
                d="M188.415 240.581L188.66 236.375L185.045 238.69L183.748 236.489L187.607 234.598L183.748 232.707L185.045 230.505L188.66 232.821L188.415 228.615H191L190.766 232.821L194.381 230.505L195.678 232.707L191.808 234.598L195.678 236.489L194.381 238.69L190.766 236.375L191 240.581H188.415Z"
                fill="#FF6F3D" />
            <path
                d="M167.537 240.581L167.781 236.375L164.166 238.69L162.869 236.489L166.728 234.598L162.869 232.707L164.166 230.505L167.781 232.821L167.537 228.615H170.121L169.887 232.821L173.502 230.505L174.799 232.707L170.929 234.598L174.799 236.489L173.502 238.69L169.887 236.375L170.121 240.581H167.537Z"
                fill="#FF6F3D" />
            <path
                d="M228.682 240.581L228.926 236.375L225.311 238.69L224.014 236.489L227.874 234.598L224.014 232.707L225.311 230.505L228.926 232.821L228.682 228.615H231.266L231.032 232.821L234.647 230.505L235.945 232.707L232.075 234.598L235.945 236.489L234.647 238.69L231.032 236.375L231.266 240.581H228.682Z"
                fill="#FF6F3D" />
            <path
                d="M146.658 240.581L146.902 236.375L143.287 238.69L141.99 236.489L145.849 234.598L141.99 232.707L143.287 230.505L146.902 232.821L146.658 228.615H149.242L149.008 232.821L152.623 230.505L153.921 232.707L150.05 234.598L153.921 236.489L152.623 238.69L149.008 236.375L149.242 240.581H146.658Z"
                fill="#FF6F3D" />
            <path
                d="M207.803 240.581L208.048 236.375L204.432 238.69L203.135 236.489L206.995 234.598L203.135 232.707L204.432 230.505L208.048 232.821L207.803 228.615H210.387L210.153 232.821L213.768 230.505L215.066 232.707L211.196 234.598L215.066 236.489L213.768 238.69L210.153 236.375L210.387 240.581H207.803Z"
                fill="#FF6F3D" />
            <defs>
                <filter id="filter0_d_231_2170" x="112.076" y="99.4534" width="150.8" height="191.547"
                    filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                    <feFlood flood-opacity="0" result="BackgroundImageFix" />
                    <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                        result="hardAlpha" />
                    <feOffset dy="7" />
                    <feGaussianBlur stdDeviation="7.5" />
                    <feColorMatrix type="matrix" values="0 0 0 0 0.333333 0 0 0 0 0.333333 0 0 0 0 0.333333 0 0 0 0.1 0" />
                    <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_231_2170" />
                    <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_231_2170" result="shape" />
                </filter>
                <filter id="filter1_d_231_2170" x="112.076" y="99.4534" width="150.8" height="191.547"
                    filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                    <feFlood flood-opacity="0" result="BackgroundImageFix" />
                    <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                        result="hardAlpha" />
                    <feOffset dy="7" />
                    <feGaussianBlur stdDeviation="7.5" />
                    <feColorMatrix type="matrix" values="0 0 0 0 0.333333 0 0 0 0 0.333333 0 0 0 0 0.333333 0 0 0 0.1 0" />
                    <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_231_2170" />
                    <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_231_2170" result="shape" />
                </filter>
            </defs>
        </svg>
        <div class="error-message" id="errorMessage">
            {{ .editorError }}
        </div>
        <div class="error-actions">
            <button class="error-button secondary" onclick="window.close()">
                {{ .closeWindow }}
            </button>
        </div>
    </div>
    <script type="text/javascript" src="{{.apijs}}"></script>
    <script type="text/javascript" language="javascript">
        var docEditor;
        var appReadyTimeout;
        var retryTimeout;
        var isAppReady = false;
        var isErrorPageShown = false;
        var retryCount = 0;
        var maxRetries = 3;
        var retryDelay = 5000;

        var innerAlert = function (message) {
            if (console && console.log)
                console.log(message);
        };

        var hideLoader = function () {
            var loadingContainer = document.getElementById("loadingContainer");
            if (loadingContainer) {
                loadingContainer.classList.add("hide");
            }
        };

        var showErrorPage = function () {
            if (isErrorPageShown) return;
            
            var errorPage = document.getElementById("errorPage");
            var form = document.getElementsByClassName("form")[0];
            
            hideLoader();
            
            if (form) {
                form.style.display = "none";
            }
            
            if (errorPage) {
                errorPage.classList.add("show");
                isErrorPageShown = true;
            }
            
            if (retryCount < maxRetries) {
                scheduleRetry();
            }
        };

        var hideErrorPage = function () {
            var errorPage = document.getElementById("errorPage");
            var form = document.getElementsByClassName("form")[0];
            
            if (errorPage) {
                errorPage.classList.remove("show");
                isErrorPageShown = false;
            }
            
            if (form) {
                form.style.display = "block";
            }
        };

        var scheduleRetry = function () {
            if (retryTimeout) {
                clearTimeout(retryTimeout);
            }
            
            retryTimeout = setTimeout(function() {
                retryCount++;
                innerAlert("Retrying connection attempt " + retryCount + " of " + maxRetries);
                retryConnection();
            }, retryDelay);
        };

        var retryConnection = function () {
            if (retryTimeout) {
                clearTimeout(retryTimeout);
            }
            
            isAppReady = false;
            
            if (docEditor) {
                try {
                    docEditor.destroyEditor();
                } catch (e) {
                }
                docEditor = null;
            }
            
            hideErrorPage();
            var loadingContainer = document.getElementById("loadingContainer");
            if (loadingContainer) {
                loadingContainer.classList.remove("hide");
            }
            
            connectEditor();
        };

        var onAppReady = function () {
            isAppReady = true;
            retryCount = 0;
            
            if (appReadyTimeout) {
                clearTimeout(appReadyTimeout);
            }
            if (retryTimeout) {
                clearTimeout(retryTimeout);
            }
            
            hideLoader();
            hideErrorPage();
            innerAlert("Document editor ready");
        };

        var onRequestClose = function () {
            if (window.opener) {
                window.close();
                return;
            }

            if (docEditor) {
                docEditor.destroyEditor();
            }
        };

        var replaceActionLink = function (href, linkParam) {
            var link;
            var actionIndex = href.indexOf("&action=");
            if (actionIndex != -1) {
                var endIndex = href.indexOf("&", actionIndex + "&action=".length);
                if (endIndex != -1) {
                    link = href.substring(0, actionIndex) + href.substring(endIndex) + "&action=" + encodeURIComponent(linkParam);
                } else {
                    link = href.substring(0, actionIndex) + "&action=" + encodeURIComponent(linkParam);
                }
            } else {
                link = href + "&action=" + encodeURIComponent(linkParam);
            }
            return link;
        }

        var onError = function (event) {
            if (event && event.data) {
                innerAlert(event.data);
            }
            showErrorPage();
        };

        var events = {
            "onAppReady": onAppReady,
            "onRequestClose": onRequestClose,
            "onError": onError,
        };

        var config = JSON.parse('{{ .config }}');
        config["events"] = events;

        var connectEditor = function () {
            try {
                if (appReadyTimeout) {
                    clearTimeout(appReadyTimeout);
                }
                
                appReadyTimeout = setTimeout(function() {
                    if (!isAppReady) {
                        innerAlert("Document editor failed to load within timeout period");
                        showErrorPage();
                    }
                }, 15000);

                docEditor = new DocsAPI.DocEditor("iframeEditor", config);
                fixSize();
            } catch (error) {
                innerAlert('[ONLYOFFICE Error]: could not initialize DocsAPI instance - ' + error.message);
                showErrorPage();
            }
        };

        var fixSize = function () {
            var wrapEl = document.getElementsByClassName("form");
            if (wrapEl.length) {
                wrapEl[0].style.height = screen.availHeight + "px";
                window.scrollTo(0, -1);
                wrapEl[0].style.height = window.innerHeight + "px";
            }
        };

        var cleanup = function () {
            if (appReadyTimeout) {
                clearTimeout(appReadyTimeout);
            }
            if (retryTimeout) {
                clearTimeout(retryTimeout);
            }
            if (docEditor) {
                try {
                    docEditor.destroyEditor();
                } catch (e) {}
            }
        };

        if (window.addEventListener) {
            window.addEventListener("load", connectEditor);
            window.addEventListener("resize", fixSize);
            window.addEventListener("beforeunload", cleanup);
            window.addEventListener("unload", cleanup);
        } else if (window.attachEvent) {
            window.attachEvent("onload", connectEditor);
            window.attachEvent("onresize", fixSize);
            window.attachEvent("onbeforeunload", cleanup);
            window.attachEvent("onunload", cleanup);
        }
    </script>
</body>
</html>
{{ end }}
